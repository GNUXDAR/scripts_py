
<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>contextvars — Variables de Contexto &#8212; documentación de Python - 3.10.10</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pydoctheme.css?2022.1" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Buscar en documentación de Python - 3.10.10"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="Sobre este documento" href="../about.html" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="_thread — API de bajo nivel para manejo de hilos" href="_thread.html" />
    <link rel="prev" title="queue — clase de cola sincronizada" href="queue.html" />
    <link rel="canonical" href="https://docs.python.org/3/library/contextvars.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="Búsqueda rápida"/>
            <input type="submit" value="Ir"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <h3><a href="../contents.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">contextvars</span></code> — Variables de Contexto</a><ul>
<li><a class="reference internal" href="#context-variables">Variables de Contexto</a></li>
<li><a class="reference internal" href="#manual-context-management">Gestión de Contexto Manual</a></li>
<li><a class="reference internal" href="#asyncio-support">Soporte asyncio</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="queue.html"
                        title="capítulo anterior"><code class="xref py py-mod docutils literal notranslate"><span class="pre">queue</span></code> — clase de cola sincronizada</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="_thread.html"
                        title="próximo capítulo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">_thread</span></code> — API de bajo nivel para manejo de hilos</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">Reporta un Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.10/Doc/library/contextvars.rst"
            rel="nofollow">Ver Fuente
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice general"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="right" >
          <a href="_thread.html" title="_thread — API de bajo nivel para manejo de hilos"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="queue.html" title="queue — clase de cola sincronizada"
             accesskey="P">anterior</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.10.10 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >La Biblioteca Estándar de Python</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="concurrency.html" accesskey="U">Ejecución concurrente</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">contextvars</span></code> — Variables de Contexto</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Búsqueda rápida" aria-label="Búsqueda rápida" type="text" name="q" />
          <input type="submit" value="Ir" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-contextvars">
<span id="contextvars-context-variables"></span><h1><a class="reference internal" href="#module-contextvars" title="contextvars: Context Variables"><code class="xref py py-mod docutils literal notranslate"><span class="pre">contextvars</span></code></a> — Variables de Contexto<a class="headerlink" href="#module-contextvars" title="Enlazar permanentemente con este título">¶</a></h1>
<hr class="docutils" />
<p>Este módulo proporciona APIs para gestionar, almacenar y acceder a estados en el contexto local. La clase <a class="reference internal" href="#contextvars.ContextVar" title="contextvars.ContextVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextVar</span></code></a> se utiliza para declarar y trabajar con Variables de Contexto (<em>Context Variables</em>). La función <a class="reference internal" href="#contextvars.copy_context" title="contextvars.copy_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">copy_context()</span></code></a> y la clase <a class="reference internal" href="#contextvars.Context" title="contextvars.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> deberían ser utilizadas para gestionar el contexto actual en frameworks asíncronos.</p>
<p>Los gestores de contexto que tienen un estado establecido deberían utilizar Variables de Contexto en lugar de <a class="reference internal" href="threading.html#threading.local" title="threading.local"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.local()</span></code></a>, para así evitar que este estado se inyecte inesperadamente a otro código, cuando se utilice en código concurrente.</p>
<p>Ver <span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0567"><strong>PEP 567</strong></a> para más detalles.</p>
<div class="versionadded">
<p><span class="versionmodified added">Nuevo en la versión 3.7.</span></p>
</div>
<section id="context-variables">
<h2>Variables de Contexto<a class="headerlink" href="#context-variables" title="Enlazar permanentemente con este título">¶</a></h2>
<dl class="py class">
<dt id="contextvars.ContextVar">
<em class="property">class </em><code class="sig-prename descclassname">contextvars.</code><code class="sig-name descname">ContextVar</code><span class="sig-paren">(</span><em class="sig-param">name</em><span class="optional">[</span>, <em class="sig-param">*</em>, <em class="sig-param">default</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.ContextVar" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Esta clase se utiliza para declarar una nueva Variable de Contexto, por ejemplo:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span><span class="p">:</span> <span class="n">ContextVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>El parámetro obligatorio <em>name</em> se utiliza para introspección y depuración.</p>
<p>El parámetro opcional de sólo palabra clave <em>default</em> es utilizado por <a class="reference internal" href="#contextvars.ContextVar.get" title="contextvars.ContextVar.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.get()</span></code></a>, cuando en el contexto actual no se encuentra ningún valor para la variable.</p>
<p><strong>Importante:</strong> las Variables de Contexto deberían ser creadas en lo más alto a nivel de módulo y nunca en clausura. Los objetos <a class="reference internal" href="#contextvars.Context" title="contextvars.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> mantienen referencias a variables de contexto, lo cual no permitiría que estas variables de contexto sean limpiadas por el recolector de basura.</p>
<dl class="py attribute">
<dt id="contextvars.ContextVar.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#contextvars.ContextVar.name" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>El nombre de la variable. Propiedad de sólo lectura.</p>
<div class="versionadded">
<p><span class="versionmodified added">Nuevo en la versión 3.7.1.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt id="contextvars.ContextVar.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">default</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.ContextVar.get" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna un valor para la variable de contexto en el contexto actual.</p>
<p>Si la variable no tiene ningún valor en el contexto actual, el método:</p>
<ul class="simple">
<li><p>retornará el valor del argumento <em>default</em> del método, si alguno fue dado; o</p></li>
<li><p>retornará el valor por defecto de la variable de contexto, si ésta fue creada con alguno; o</p></li>
<li><p>lanzará <a class="reference internal" href="exceptions.html#LookupError" title="LookupError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">LookupError</span></code></a>.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt id="contextvars.ContextVar.set">
<code class="sig-name descname">set</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.ContextVar.set" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Establece un nuevo valor para la variable de contexto en el contexto actual.</p>
<p>El argumento obligatorio <em>value</em> es el nuevo valor de la variable de contexto.</p>
<p>Retorna un objeto <a class="reference internal" href="#contextvars.Token" title="contextvars.Token"><code class="xref py py-class docutils literal notranslate"><span class="pre">Token</span></code></a> que puede utilizarse para restaurar la variable a su valor anterior, utilizando el método <a class="reference internal" href="#contextvars.ContextVar.reset" title="contextvars.ContextVar.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.reset()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.ContextVar.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token</span></em><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.ContextVar.reset" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Restablece la variable de contexto al valor que tenía antes de llamar al método <a class="reference internal" href="#contextvars.ContextVar.set" title="contextvars.ContextVar.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.set()</span></code></a>, que creó el <em>token</em> utilizado.</p>
<p>Por ejemplo:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;new value&#39;</span><span class="p">)</span>
<span class="c1"># code that uses &#39;var&#39;; var.get() returns &#39;new value&#39;.</span>
<span class="n">var</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

<span class="c1"># After the reset call the var has no value again, so</span>
<span class="c1"># var.get() would raise a LookupError.</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="contextvars.Token">
<em class="property">class </em><code class="sig-prename descclassname">contextvars.</code><code class="sig-name descname">Token</code><a class="headerlink" href="#contextvars.Token" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Los objetos <em>token</em> son retornados por el método <a class="reference internal" href="#contextvars.ContextVar.set" title="contextvars.ContextVar.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.set()</span></code></a>. Se le pueden dar al método <a class="reference internal" href="#contextvars.ContextVar.reset" title="contextvars.ContextVar.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.reset()</span></code></a> para restablecer el valor de la variable al que estuviese dado antes del <em>set</em> correspondiente.</p>
<dl class="py attribute">
<dt id="contextvars.Token.var">
<code class="sig-name descname">var</code><a class="headerlink" href="#contextvars.Token.var" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Propiedad de sólo lectura. Apunta al objeto <a class="reference internal" href="#contextvars.ContextVar" title="contextvars.ContextVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextVar</span></code></a> que creó el <em>token</em>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="contextvars.Token.old_value">
<code class="sig-name descname">old_value</code><a class="headerlink" href="#contextvars.Token.old_value" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>A read-only property.  Set to the value the variable had before
the <a class="reference internal" href="#contextvars.ContextVar.set" title="contextvars.ContextVar.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContextVar.set()</span></code></a> method call that created the token.
It points to <a class="reference internal" href="#contextvars.Token.MISSING" title="contextvars.Token.MISSING"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Token.MISSING</span></code></a> if the variable was not set
before the call.</p>
</dd></dl>

<dl class="py attribute">
<dt id="contextvars.Token.MISSING">
<code class="sig-name descname">MISSING</code><a class="headerlink" href="#contextvars.Token.MISSING" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Marcador utilizado por <a class="reference internal" href="#contextvars.Token.old_value" title="contextvars.Token.old_value"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Token.old_value</span></code></a>.</p>
</dd></dl>

</dd></dl>

</section>
<section id="manual-context-management">
<h2>Gestión de Contexto Manual<a class="headerlink" href="#manual-context-management" title="Enlazar permanentemente con este título">¶</a></h2>
<dl class="py function">
<dt id="contextvars.copy_context">
<code class="sig-prename descclassname">contextvars.</code><code class="sig-name descname">copy_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.copy_context" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna una copia del objeto <a class="reference internal" href="#contextvars.Context" title="contextvars.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> actual.</p>
<p>El siguiente código obtiene una copia del contexto actual e imprime todas las variables y sus valores establecidos en el contexto:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span> <span class="o">=</span> <span class="n">copy_context</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</pre></div>
</div>
<p>La función tiene una complejidad de O(1); es decir, trabaja a la misma velocidad en contextos con pocas o con muchas variables de contexto.</p>
</dd></dl>

<dl class="py class">
<dt id="contextvars.Context">
<em class="property">class </em><code class="sig-prename descclassname">contextvars.</code><code class="sig-name descname">Context</code><a class="headerlink" href="#contextvars.Context" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Mapeo de <a class="reference internal" href="#contextvars.ContextVar" title="contextvars.ContextVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextVars</span></code></a> con sus valores.</p>
<p><code class="docutils literal notranslate"><span class="pre">Context()</span></code> crea un contexto vacío sin valores. Para obtener una copia del contexto actual, se puede utilizar la función <a class="reference internal" href="#contextvars.copy_context" title="contextvars.copy_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">copy_context()</span></code></a>.</p>
<p>Every thread will have a different top-level <a class="reference internal" href="#contextvars.Context" title="contextvars.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>
object. This means that a <a class="reference internal" href="#contextvars.ContextVar" title="contextvars.ContextVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextVar</span></code></a> object behaves in a similar
fashion to <a class="reference internal" href="threading.html#threading.local" title="threading.local"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.local()</span></code></a> when values are assigned in different
threads.</p>
<p><em>Context</em> implementa la interfaz <a class="reference internal" href="collections.abc.html#collections.abc.Mapping" title="collections.abc.Mapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a>.</p>
<dl class="py method">
<dt id="contextvars.Context.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">callable</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.run" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Ejecuta el código de <code class="docutils literal notranslate"><span class="pre">callable(*args,</span> <span class="pre">**kwargs)</span></code> en el objeto de contexto del cual se llama al método <em>run</em>. Retorna el resultado de la ejecución, o propaga una excepción si alguna ocurre.</p>
<p>Cualquier cambio realizado por <em>callable</em> sobre cualquier variable de contexto será contenido en el objeto de contexto:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>
<span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># &#39;var&#39; was set to &#39;spam&#39; before</span>
    <span class="c1"># calling &#39;copy_context()&#39; and &#39;ctx.run(main)&#39;, so:</span>
    <span class="c1"># var.get() == ctx[var] == &#39;spam&#39;</span>

    <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ham&#39;</span><span class="p">)</span>

    <span class="c1"># Now, after setting &#39;var&#39; to &#39;ham&#39;:</span>
    <span class="c1"># var.get() == ctx[var] == &#39;ham&#39;</span>

<span class="n">ctx</span> <span class="o">=</span> <span class="n">copy_context</span><span class="p">()</span>

<span class="c1"># Any changes that the &#39;main&#39; function makes to &#39;var&#39;</span>
<span class="c1"># will be contained in &#39;ctx&#39;.</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="c1"># The &#39;main()&#39; function was run in the &#39;ctx&#39; context,</span>
<span class="c1"># so changes to &#39;var&#39; are contained in it:</span>
<span class="c1"># ctx[var] == &#39;ham&#39;</span>

<span class="c1"># However, outside of &#39;ctx&#39;, &#39;var&#39; is still set to &#39;spam&#39;:</span>
<span class="c1"># var.get() == &#39;spam&#39;</span>
</pre></div>
</div>
<p>El método lanzará <a class="reference internal" href="exceptions.html#RuntimeError" title="RuntimeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> cuando es llamado desde el mismo objeto de contexto desde más de un hilo del sistema operativo, o si se llama recursivamente.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.Context.copy">
<code class="sig-name descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.copy" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna una copia superficial (<em>shallow copy</em>) del objeto de contexto.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">var in context</code></dt>
<dd><p>Retorna <code class="docutils literal notranslate"><span class="pre">True</span></code> si <em>context</em> tiene un valor establecido para <em>var</em>; de lo contrario, retorna <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">context[var]</code></dt>
<dd><p>Retorna el valor de la variable <a class="reference internal" href="#contextvars.ContextVar" title="contextvars.ContextVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextVar</span></code></a> <em>var</em>. Si la variable no está establecida en el contexto actual, se lanzará <a class="reference internal" href="exceptions.html#KeyError" title="KeyError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.Context.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">var</em><span class="optional">[</span>, <em class="sig-param">default</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.get" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna el valor de <em>var</em>, si <em>var</em> tiene el valor en el objeto de contexto; de lo contrario, retorna <em>default</em>. Si <em>default</em> no es dado, retorna <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">iter(context)</code></dt>
<dd><p>Retorna un iterador de las variables almacenadas en el objeto de contexto.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">len(proxy)</code></dt>
<dd><p>Retorna el número de variables establecidas en el objeto de contexto.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.Context.keys">
<code class="sig-name descname">keys</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.keys" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna un listado de todas las variables en el objeto de contexto.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.Context.values">
<code class="sig-name descname">values</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.values" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna un listado de los valores de todas las variables en el objeto de contexto.</p>
</dd></dl>

<dl class="py method">
<dt id="contextvars.Context.items">
<code class="sig-name descname">items</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#contextvars.Context.items" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Retorna un listado de dos tuplas que contienen todas las variables y sus variables en el contexto actual.</p>
</dd></dl>

</dd></dl>

</section>
<section id="asyncio-support">
<h2>Soporte asyncio<a class="headerlink" href="#asyncio-support" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las variables de contexto están soportadas de forma nativa en <a class="reference internal" href="asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> y se pueden utilizar sin ninguna configuración adicional. Por ejemplo, el siguiente código crea un servidor simple de respuesta, que utiliza una variable de contexto que hace que la dirección del cliente remoto esté disponible en la <em>Task</em> que gestiona al cliente:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">contextvars</span>

<span class="n">client_addr_var</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;client_addr&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">render_goodbye</span><span class="p">():</span>
    <span class="c1"># The address of the currently handled client can be accessed</span>
    <span class="c1"># without passing it explicitly to this function.</span>

    <span class="n">client_addr</span> <span class="o">=</span> <span class="n">client_addr_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Good bye, client @ </span><span class="si">{</span><span class="n">client_addr</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s1">&#39;socket&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()</span>
    <span class="n">client_addr_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>

    <span class="c1"># In any code that we call is now possible to get</span>
    <span class="c1"># client&#39;s address by calling &#39;client_addr_var.get()&#39;.</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">render_goodbye</span><span class="p">())</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">srv</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">start_server</span><span class="p">(</span>
        <span class="n">handle_request</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8081</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">srv</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">srv</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>

<span class="c1"># To test it you can use telnet:</span>
<span class="c1">#     telnet 127.0.0.1 8081</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">contextvars</span></code> — Variables de Contexto</a><ul>
<li><a class="reference internal" href="#context-variables">Variables de Contexto</a></li>
<li><a class="reference internal" href="#manual-context-management">Gestión de Contexto Manual</a></li>
<li><a class="reference internal" href="#asyncio-support">Soporte asyncio</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="queue.html"
                        title="capítulo anterior"><code class="xref py py-mod docutils literal notranslate"><span class="pre">queue</span></code> — clase de cola sincronizada</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="_thread.html"
                        title="próximo capítulo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">_thread</span></code> — API de bajo nivel para manejo de hilos</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">Reporta un Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.10/Doc/library/contextvars.rst"
            rel="nofollow">Ver Fuente
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice general"
             >índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="right" >
          <a href="_thread.html" title="_thread — API de bajo nivel para manejo de hilos"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="queue.html" title="queue — clase de cola sincronizada"
             >anterior</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.10.10 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >La Biblioteca Estándar de Python</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="concurrency.html" >Ejecución concurrente</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">contextvars</span></code> — Variables de Contexto</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Búsqueda rápida" aria-label="Búsqueda rápida" type="text" name="q" />
          <input type="submit" value="Ir" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2001-2023, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="/license.html">History and License</a> for more information.<br />
    <br />

    La Python Software Foundation es una organización sin fines de lucro.
<a href="https://www.python.org/psf/donations/">Por favor, haga una donación.</a>
<br />
    <br />

    Última actualización el mar 27, 2023.
    <a href="/bugs.html">Found a bug</a>?
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>

  </body>
</html>